<?php
function p($f){return __DIR__.str_replace('_','/',"/$f.php");}function url($k=-1){static$u;$u=$u?$u:array_slice(explode('/',$_SERVER['REQUEST_URI']),1);return$k!=-1?(isset($u[$k])?$u[$k]:0):$u;}function __autoload($c){require p("classes/$c");}function c($k){static$c;$c=$c?$c:require p('config');return$c[$k];}function _log($m){file_put_contents('log/.'.date('Y-m-d'),date('H:i')." $m\n",FILE_APPEND);}function db($dsn,$u,$p){static$d;return$d=$d?$d:(new PDO($dns,$u,$p));}function q($q,$p=NULL){$s=db()->prepare($q);$s->execute($p);return$s;}set_error_handler(function($c,$e,$f=0,$l=0){$v=new View('error');$v->error=$e;echo$v;_log("$e [$f:$l]");return TRUE;});class View{function View($v){$this->v=p("views/$v");}function __toString(){ob_start();extract((array)$this);require$v;return ob_get_clean();}}$c='controller_'.(($c=url(0))?$c:'home');$m=(($m=url(1))?$m:'index');if(!is_file(p("classes/$c"))||!($c=new$c)||!method_exists($c,$m))exit(new View('404'));call_user_func_array(array($c,$m,array_slice(url(),2)));//